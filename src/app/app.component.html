<!-- src/app/app.component.html -->

<div class="app-container">

  <!-- Main Toolbar -->
  <mat-toolbar class="main-toolbar" color="primary">
    <button
      type="button"
      aria-label="Toggle sidenav"
      mat-icon-button
      (click)="drawer.toggle()"
      *ngIf="isHandset$ | async">
      <mat-icon aria-label="Side nav toggle icon">menu</mat-icon>
    </button>

    <!-- App Title & Project Info -->
    <div class="toolbar-title">
      <span class="app-title">{{ title }}</span>
      <span class="project-info" *ngIf="currentProject">
        - {{ currentProject.name }}
        <span class="screen-info" *ngIf="currentScreen">
          / {{ getCurrentScreenName() }}
        </span>
      </span>
    </div>

    <div class="toolbar-spacer"></div>

    <!-- Main Actions -->
    <div class="main-actions">
      <!-- Undo/Redo -->
      <button
        mat-icon-button
        matTooltip="Undo"
        [disabled]="!canUndo()"
        (click)="onUndo()">
        <mat-icon>undo</mat-icon>
      </button>
      <button
        mat-icon-button
        matTooltip="Redo"
        [disabled]="!canRedo()"
        (click)="onRedo()">
        <mat-icon>redo</mat-icon>
      </button>

      <mat-divider [vertical]="true" class="toolbar-divider"></mat-divider>

      <!-- Save -->
      <button
        mat-raised-button
        color="accent"
        (click)="onSave()"
        [disabled]="!currentScreen">
        <mat-icon>save</mat-icon>
        Save
      </button>

      <!-- More Actions Menu -->
      <button mat-icon-button [matMenuTriggerFor]="actionsMenu">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #actionsMenu="matMenu">
        <button mat-menu-item (click)="onClearCanvas()">
          <mat-icon>clear</mat-icon>
          <span>Clear Canvas</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="onGenerateCode()">
          <mat-icon>code</mat-icon>
          <span>Generate Code</span>
        </button>
        <button mat-menu-item (click)="onDownloadProject()">
          <mat-icon>download</mat-icon>
          <span>Download Project</span>
        </button>
        <button mat-menu-item (click)="onBuildAPK()">
          <mat-icon>build</mat-icon>
          <span>Build APK</span>
        </button>
      </mat-menu>

      <!-- Panel Toggles -->
      <div class="panel-toggles" *ngIf="!(isHandset$ | async)">
        <button
          mat-icon-button
          matTooltip="Toggle Layers Panel"
          [class.active]="showLayersPanel"
          (click)="toggleLayersPanel()">
          <mat-icon>layers</mat-icon>
        </button>
        <button
          mat-icon-button
          matTooltip="Toggle Properties Panel"
          [class.active]="showPropertiesPanel"
          (click)="togglePropertiesPanel()">
          <mat-icon>tune</mat-icon>
        </button>
        <button
          mat-icon-button
          matTooltip="Toggle Preview Panel"
          [class.active]="showPreviewPanel"
          (click)="togglePreviewPanel()">
          <mat-icon>preview</mat-icon>
        </button>
      </div>
    </div>
  </mat-toolbar>

  <!-- Main Layout -->
  <mat-sidenav-container class="sidenav-container" [hasBackdrop]="isHandset$ | async">

    <!-- Mobile Drawer -->
    <mat-sidenav
      #drawer
      class="sidenav"
      fixedInViewport
      [attr.role]="(isHandset$ | async) ? 'dialog' : 'navigation'"
      [mode]="(isHandset$ | async) ? 'over' : 'side'"
      [opened]="(isHandset$ | async) === false">

      <!-- Widget Toolbox -->
      <div class="drawer-content">
        <app-widget-toolbox></app-widget-toolbox>
      </div>
    </mat-sidenav>

    <!-- Main Content -->
    <mat-sidenav-content class="main-content">

      <!-- Desktop Layout -->
      <div class="desktop-layout" *ngIf="!(isHandset$ | async)">

        <!-- Left Sidebar (Widget Toolbox) -->
        <div class="left-sidebar" [class.collapsed]="drawer.opened === false">
          <app-widget-toolbox></app-widget-toolbox>
        </div>

        <!-- Center Area -->
        <div class="center-area">

          <!-- Secondary Toolbar -->
          <div class="secondary-toolbar" *ngIf="currentProject">

            <!-- Screen Selector -->
            <div class="screen-selector">
              <mat-form-field appearance="outline" class="screen-select">
                <mat-label>Current Screen</mat-label>
                <mat-select
                  [value]="currentScreen?.id"
                  (selectionChange)="onScreenSelectionChange($event.value)">
                  <mat-option
                    *ngFor="let screen of projectScreens"
                    [value]="screen.id">
                    {{ screen.name }} {{ screen.is_home ? '(Home)' : '' }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Canvas Controls -->
            <div class="canvas-controls">
              <mat-button-toggle-group name="viewMode" aria-label="View Mode">
                <mat-button-toggle value="design">Design</mat-button-toggle>
                <mat-button-toggle value="preview" [disabled]="true">Preview</mat-button-toggle>
              </mat-button-toggle-group>
            </div>

            <!-- Zoom Controls -->
            <div class="zoom-controls">
              <button mat-icon-button matTooltip="Zoom Out">
                <mat-icon>zoom_out</mat-icon>
              </button>
              <span class="zoom-level">100%</span>
              <button mat-icon-button matTooltip="Zoom In">
                <mat-icon>zoom_in</mat-icon>
              </button>
            </div>
          </div>

          <!-- Canvas Area -->
          <div class="canvas-area">
            <app-builder-canvas></app-builder-canvas>
          </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">

          <!-- Tabbed Panels -->
          <mat-tab-group class="panels-tabs" dynamicHeight>

            <!-- Properties Panel -->
            <mat-tab *ngIf="showPropertiesPanel">
              <ng-template mat-tab-label>
                <mat-icon class="tab-icon">tune</mat-icon>
                Properties
              </ng-template>
              <div class="tab-content">
                <app-properties-panel></app-properties-panel>
              </div>
            </mat-tab>

            <!-- Layers Panel -->
            <mat-tab *ngIf="showLayersPanel">
              <ng-template mat-tab-label>
                <mat-icon class="tab-icon">layers</mat-icon>
                Layers
              </ng-template>
              <div class="tab-content">
                <app-layers-panel></app-layers-panel>
              </div>
            </mat-tab>

            <!-- Preview Panel -->
            <mat-tab *ngIf="showPreviewPanel">
              <ng-template mat-tab-label>
                <mat-icon class="tab-icon">preview</mat-icon>
                Preview
              </ng-template>
              <div class="tab-content">
                <app-preview-panel></app-preview-panel>
              </div>
            </mat-tab>

          </mat-tab-group>
        </div>
      </div>

      <!-- Mobile Layout -->
      <div class="mobile-layout" *ngIf="isHandset$ | async">
        <div class="mobile-canvas">
          <app-builder-canvas></app-builder-canvas>
        </div>

        <!-- Mobile Bottom Tabs -->
        <mat-tab-group class="mobile-tabs">
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>tune</mat-icon>
            </ng-template>
            <app-properties-panel></app-properties-panel>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>layers</mat-icon>
            </ng-template>
            <app-layers-panel></app-layers-panel>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>preview</mat-icon>
            </ng-template>
            <app-preview-panel></app-preview-panel>
          </mat-tab>
        </mat-tab-group>
      </div>

    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
